{"ast":null,"code":"import axios from \"axios\";\nimport { JOGAKBO_CONTRACT_ADDRESS } from \"../constants/constants.cypress\";\nconst A2P_API_PREPARE_URL = \"https://a2a-api.klipwallet.com/v2/a2a/prepare\";\nconst APP_NAME = \"JOGAKBO\"; // const isMobile = window.screen.width >= 1280 ? false : true;\n\nconst isMobile = false;\n\nconst getKlipAccessUrl = (method, request_key) => {\n  if (method === \"QR\") {\n    return `https://klipwallet.com/?target=/a2a?request_key=${request_key}`;\n  }\n\n  return `kakaotalk://klipwallet/open?url=https://klipwallet.com/?target=/a2a?request_key=${request_key}`;\n}; // 캠페인 등록\n\n\nexport const createCampaign = async (_campaign_address, // 캠페인 제출자 주소\n_target_amount, _campaign_ID, setQrvalue, callback) => {\n  const functionJson = '{\"constant\":false,\"inputs\":[{\"name\":\"_campaign_address\",\"type\":\"address\"},{\"name\":\"_target_amount\",\"type\":\"uint256\"},{\"name\":\"_campaign_ID\",\"type\":\"uint256\"}],\"name\":\"createCampaign\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"}';\n  executeContract(JOGAKBO_CONTRACT_ADDRESS, functionJson, \"0\", `[\\\"${_campaign_address}\\\",\\\"${_target_amount}\\\",\\\"${_campaign_ID}\\\"]`, setQrvalue, callback);\n}; // 환불\n\nexport const refund = async (_campaignId, _userAddr, setQrvalue, callback) => {\n  const functionJson = '{\"constant\":false,\"inputs\":[{\"name\":\"_campaignId\",\"type\":\"uint256\"},{\"name\":\"_userAddr\",\"type\":\"address\"}],\"name\":\"refund\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"}';\n  executeContract(JOGAKBO_CONTRACT_ADDRESS, functionJson, \"0\", `[\\\"${_campaignId}\\\",\\\"${_userAddr}\\\"]`, setQrvalue, callback);\n}; // 기부\n\nexport const donateTocampaign = async (_campaignId, _amount, setQrvalue, callback) => {\n  const functionJson = '{\"constant\":false,\"inputs\":[{\"name\":\"_campaignId\",\"type\":\"uint256\"},{\"name\":\"_amount\",\"type\":\"uint256\"}],\"name\":\"donateTocampaign\",\"outputs\":[],\"payable\":true,\"stateMutability\":\"payable\",\"type\":\"function\"}';\n  executeContract(JOGAKBO_CONTRACT_ADDRESS, functionJson, (_amount * 10 ** 18).toString(), `[\\\"${_campaignId}\\\",\\\"${_amount}\\\"]`, setQrvalue, callback);\n}; // 환불 상태 변경\n\nexport const setStateToRefund = async (_campaignId, setQrvalue, callback) => {\n  const functionJson = '{\"constant\":false,\"inputs\":[{\"name\":\"_campaignId\",\"type\":\"uint256\"}],\"name\":\"setStateToRefund\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"}';\n  executeContract(JOGAKBO_CONTRACT_ADDRESS, functionJson, \"0\", `[\\\"${_campaignId}\\\"]`, setQrvalue, callback);\n};\nexport const executeContract = (txTo, functionJSON, value, params, setQrvalue, callback) => {\n  axios.post(A2P_API_PREPARE_URL, {\n    bapp: {\n      name: APP_NAME\n    },\n    type: \"execute_contract\",\n    transaction: {\n      to: txTo,\n      // string\n      value: value,\n      // string\n      abi: functionJSON,\n      // string\n      params: params // string\n\n    }\n  }).then(response => {\n    const {\n      request_key\n    } = response.data;\n\n    if (isMobile) {\n      window.location.href = getKlipAccessUrl(\"android\", request_key);\n    } else {\n      setQrvalue(getKlipAccessUrl(\"QR\", request_key));\n    }\n\n    let timerId = setInterval(() => {\n      axios.get(`https://a2a-api.klipwallet.com/v2/a2a/result?request_key=${request_key}`).then(res => {\n        if (res.data.result) {\n          console.log(`[result] ${JSON.stringify(res.data.result)}`);\n          callback(res.data.result);\n          clearInterval(timerId);\n          setQrvalue(\"DEFAULT\");\n        }\n      });\n    }, 1000);\n  });\n}; // 클립 주소얻기\n\nexport const getAddress = (setQrvalue, callback) => {\n  axios.post(A2P_API_PREPARE_URL, {\n    bapp: {\n      name: APP_NAME\n    },\n    type: \"auth\"\n  }).then(response => {\n    const {\n      request_key\n    } = response.data;\n\n    if (isMobile) {\n      window.location.href = getKlipAccessUrl(\"android\", request_key);\n    } else {\n      setQrvalue(getKlipAccessUrl(\"QR\", request_key));\n    }\n\n    console.log(`response:${response}`);\n    let timerId = setInterval(() => {\n      axios.get(`https://a2a-api.klipwallet.com/v2/a2a/result?request_key=${request_key}`).then(res => {\n        if (res.data.result) {\n          console.log(`[Result] ${JSON.stringify(res.data.result)}`);\n          callback(res.data.result.klaytn_address);\n          clearInterval(timerId);\n          setQrvalue(\"DEFAULT\");\n        }\n      });\n    }, 1000);\n  });\n};","map":null,"metadata":{},"sourceType":"module"}