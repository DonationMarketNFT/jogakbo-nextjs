{"ast":null,"code":"import axios from \"axios\";\nimport { JOGAKBO_CONTRACT_ADDRESS } from \"../constants/constants.cypress\";\nimport { fromKlaytoPeb } from \"./UseCaver\";\nconst A2P_API_PREPARE_URL = \"https://a2a-api.klipwallet.com/v2/a2a/prepare\";\nconst APP_NAME = \"JOGAKBO\"; // const isMobile = window.screen.width >= 1280 ? false : true;\n\nconst isMobile = false;\n\nconst getKlipAccessUrl = (method, request_key) => {\n  if (method === \"QR\") {\n    return `https://klipwallet.com/?target=/a2a?request_key=${request_key}`;\n  }\n\n  return `kakaotalk://klipwallet/open?url=https://klipwallet.com/?target=/a2a?request_key=${request_key}`;\n}; // 캠페인 등록\n\n\nexport const createCampaign = async (_campaign_address, // 캠페인 제출자 주소\n_target_amount, _campaign_ID, setQrvalue, callback) => {\n  const functionJson = '{\"constant\":false,\"inputs\":[{\"name\":\"_campaign_address\",\"type\":\"address\"},{\"name\":\"_target_amount\",\"type\":\"uint256\"},{\"name\":\"_campaign_ID\",\"type\":\"uint256\"}],\"name\":\"createCampaign\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"}';\n  executeContract(JOGAKBO_CONTRACT_ADDRESS, functionJson, \"0\", `[\\\"${_campaign_address}\\\",\\\"${_target_amount}\\\",\\\"${_campaign_ID}\\\"]`, setQrvalue, callback);\n}; // 환불\n\nexport const refund = async (_campaignId, _userAddr, setQrvalue, callback) => {\n  const functionJson = '{\"constant\":false,\"inputs\":[{\"name\":\"_campaignId\",\"type\":\"uint256\"},{\"name\":\"_userAddr\",\"type\":\"address\"}],\"name\":\"refund\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"}';\n  executeContract(JOGAKBO_CONTRACT_ADDRESS, functionJson, \"0\", `[\\\"${_campaignId}\\\",\\\"${_userAddr}\\\"]`, setQrvalue, callback);\n}; // 기부\n\nexport const donateTocampaign = async (_campaignId, _amount, setQrvalue, callback) => {\n  const functionJson = '{\"constant\":false,\"inputs\":[{\"name\":\"_campaignId\",\"type\":\"uint256\"},{\"name\":\"_amount\",\"type\":\"uint256\"}],\"name\":\"donateTocampaign\",\"outputs\":[],\"payable\":true,\"stateMutability\":\"payable\",\"type\":\"function\"}';\n  executeContract(JOGAKBO_CONTRACT_ADDRESS, functionJson, fromKlaytoPeb(_amount).toString(), `[\\\"${_campaignId}\\\",\\\"${_amount}\\\"]`, setQrvalue, callback);\n}; // 환불 상태 변경\n\nexport const setStateToRefund = async (_campaignId, setQrvalue, callback) => {\n  const functionJson = '{\"constant\":false,\"inputs\":[{\"name\":\"_campaignId\",\"type\":\"uint256\"}],\"name\":\"setStateToRefund\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"}';\n  executeContract(JOGAKBO_CONTRACT_ADDRESS, functionJson, \"0\", `[\\\"${_campaignId}\\\"]`, setQrvalue, callback);\n};\nexport const executeContract = (txTo, functionJSON, value, params, setQrvalue, callback) => {\n  axios.post(A2P_API_PREPARE_URL, {\n    bapp: {\n      name: APP_NAME\n    },\n    type: \"execute_contract\",\n    transaction: {\n      to: txTo,\n      // string\n      value: value,\n      // string\n      abi: functionJSON,\n      // string\n      params: params // string\n\n    }\n  }).then(response => {\n    const {\n      request_key\n    } = response.data;\n\n    if (isMobile) {\n      window.location.href = getKlipAccessUrl(\"android\", request_key);\n    } else {\n      setQrvalue(getKlipAccessUrl(\"QR\", request_key));\n    }\n\n    let timerId = setInterval(() => {\n      axios.get(`https://a2a-api.klipwallet.com/v2/a2a/result?request_key=${request_key}`).then(res => {\n        if (res.data.result) {\n          console.log(`[result] ${JSON.stringify(res.data.result)}`);\n          callback(res.data.result);\n          clearInterval(timerId);\n          setQrvalue(\"DEFAULT\");\n        }\n      });\n    }, 1000);\n  });\n}; // 클립 주소얻기\n\nexport const getAddress = (setQrvalue, callback) => {\n  axios.post(A2P_API_PREPARE_URL, {\n    bapp: {\n      name: APP_NAME\n    },\n    type: \"auth\"\n  }).then(response => {\n    const {\n      request_key\n    } = response.data;\n\n    if (isMobile) {\n      window.location.href = getKlipAccessUrl(\"android\", request_key);\n    } else {\n      setQrvalue(getKlipAccessUrl(\"QR\", request_key));\n    }\n\n    console.log(`response:${response}`);\n    let timerId = setInterval(() => {\n      axios.get(`https://a2a-api.klipwallet.com/v2/a2a/result?request_key=${request_key}`).then(res => {\n        if (res.data.result) {\n          console.log(`[Result] ${JSON.stringify(res.data.result)}`);\n          callback(res.data.result.klaytn_address);\n          clearInterval(timerId);\n          setQrvalue(\"DEFAULT\");\n        }\n      });\n    }, 1000);\n  });\n};","map":{"version":3,"sources":["/Users/kimdawoon/jogakbo-nextjs/jogakbo-nextjs/src/api/UseKlip.js"],"names":["axios","JOGAKBO_CONTRACT_ADDRESS","fromKlaytoPeb","A2P_API_PREPARE_URL","APP_NAME","isMobile","getKlipAccessUrl","method","request_key","createCampaign","_campaign_address","_target_amount","_campaign_ID","setQrvalue","callback","functionJson","executeContract","refund","_campaignId","_userAddr","donateTocampaign","_amount","toString","setStateToRefund","txTo","functionJSON","value","params","post","bapp","name","type","transaction","to","abi","then","response","data","window","location","href","timerId","setInterval","get","res","result","console","log","JSON","stringify","clearInterval","getAddress","klaytn_address"],"mappings":"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","sourcesContent":["import axios from \"axios\";\nimport {JOGAKBO_CONTRACT_ADDRESS} from \"../constants/constants.cypress\";\nimport {fromKlaytoPeb} from \"./UseCaver\";\n\nconst A2P_API_PREPARE_URL = \"https://a2a-api.klipwallet.com/v2/a2a/prepare\";\nconst APP_NAME = \"JOGAKBO\";\n// const isMobile = window.screen.width >= 1280 ? false : true;\nconst isMobile = false;\n\nconst getKlipAccessUrl = (method, request_key) => {\n  if (method === \"QR\") {\n    return `https://klipwallet.com/?target=/a2a?request_key=${request_key}`;\n  }\n  return `kakaotalk://klipwallet/open?url=https://klipwallet.com/?target=/a2a?request_key=${request_key}`;\n};\n\n// 캠페인 등록\nexport const createCampaign = async (\n  _campaign_address, // 캠페인 제출자 주소\n  _target_amount,\n  _campaign_ID,\n  setQrvalue,\n  callback,\n) => {\n  const functionJson =\n    '{\"constant\":false,\"inputs\":[{\"name\":\"_campaign_address\",\"type\":\"address\"},{\"name\":\"_target_amount\",\"type\":\"uint256\"},{\"name\":\"_campaign_ID\",\"type\":\"uint256\"}],\"name\":\"createCampaign\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"}';\n  executeContract(\n    JOGAKBO_CONTRACT_ADDRESS,\n    functionJson,\n    \"0\",\n    `[\\\"${_campaign_address}\\\",\\\"${_target_amount}\\\",\\\"${_campaign_ID}\\\"]`,\n    setQrvalue,\n    callback,\n  );\n};\n\n// 환불\nexport const refund = async (_campaignId, _userAddr, setQrvalue, callback) => {\n  const functionJson =\n    '{\"constant\":false,\"inputs\":[{\"name\":\"_campaignId\",\"type\":\"uint256\"},{\"name\":\"_userAddr\",\"type\":\"address\"}],\"name\":\"refund\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"}';\n  executeContract(\n    JOGAKBO_CONTRACT_ADDRESS,\n    functionJson,\n    \"0\",\n    `[\\\"${_campaignId}\\\",\\\"${_userAddr}\\\"]`,\n    setQrvalue,\n    callback,\n  );\n};\n\n// 기부\nexport const donateTocampaign = async (\n  _campaignId,\n  _amount,\n  setQrvalue,\n  callback,\n) => {\n  const functionJson =\n    '{\"constant\":false,\"inputs\":[{\"name\":\"_campaignId\",\"type\":\"uint256\"},{\"name\":\"_amount\",\"type\":\"uint256\"}],\"name\":\"donateTocampaign\",\"outputs\":[],\"payable\":true,\"stateMutability\":\"payable\",\"type\":\"function\"}';\n  executeContract(\n    JOGAKBO_CONTRACT_ADDRESS,\n    functionJson,\n    fromKlaytoPeb(_amount).toString(),\n    `[\\\"${_campaignId}\\\",\\\"${_amount}\\\"]`,\n    setQrvalue,\n    callback,\n  );\n};\n\n// 환불 상태 변경\nexport const setStateToRefund = async (_campaignId, setQrvalue, callback) => {\n  const functionJson =\n    '{\"constant\":false,\"inputs\":[{\"name\":\"_campaignId\",\"type\":\"uint256\"}],\"name\":\"setStateToRefund\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"}';\n  executeContract(\n    JOGAKBO_CONTRACT_ADDRESS,\n    functionJson,\n    \"0\",\n    `[\\\"${_campaignId}\\\"]`,\n    setQrvalue,\n    callback,\n  );\n};\n\nexport const executeContract = (\n  txTo,\n  functionJSON,\n  value,\n  params,\n  setQrvalue,\n  callback,\n) => {\n  axios\n    .post(A2P_API_PREPARE_URL, {\n      bapp: {\n        name: APP_NAME,\n      },\n      type: \"execute_contract\",\n      transaction: {\n        to: txTo, // string\n        value: value, // string\n        abi: functionJSON, // string\n        params: params, // string\n      },\n    })\n    .then(response => {\n      const {request_key} = response.data;\n      if (isMobile) {\n        window.location.href = getKlipAccessUrl(\"android\", request_key);\n      } else {\n        setQrvalue(getKlipAccessUrl(\"QR\", request_key));\n      }\n      let timerId = setInterval(() => {\n        axios\n          .get(\n            `https://a2a-api.klipwallet.com/v2/a2a/result?request_key=${request_key}`,\n          )\n          .then(res => {\n            if (res.data.result) {\n              console.log(`[result] ${JSON.stringify(res.data.result)}`);\n              callback(res.data.result);\n              clearInterval(timerId);\n              setQrvalue(\"DEFAULT\");\n            }\n          });\n      }, 1000);\n    });\n};\n\n// 클립 주소얻기\nexport const getAddress = (setQrvalue, callback) => {\n  axios\n    .post(A2P_API_PREPARE_URL, {\n      bapp: {\n        name: APP_NAME,\n      },\n      type: \"auth\",\n    })\n    .then(response => {\n      const {request_key} = response.data;\n      if (isMobile) {\n        window.location.href = getKlipAccessUrl(\"android\", request_key);\n      } else {\n        setQrvalue(getKlipAccessUrl(\"QR\", request_key));\n      }\n      console.log(`response:${response}`);\n      let timerId = setInterval(() => {\n        axios\n          .get(\n            `https://a2a-api.klipwallet.com/v2/a2a/result?request_key=${request_key}`,\n          )\n          .then(res => {\n            if (res.data.result) {\n              console.log(`[Result] ${JSON.stringify(res.data.result)}`);\n              callback(res.data.result.klaytn_address);\n              clearInterval(timerId);\n              setQrvalue(\"DEFAULT\");\n            }\n          });\n      }, 1000);\n    });\n};\n"]},"metadata":{},"sourceType":"module"}