{"ast":null,"code":"import _regeneratorRuntime from \"/Users/kimdawoon/jogakbo-nextjs/jogakbo-nextjs/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/kimdawoon/jogakbo-nextjs/jogakbo-nextjs/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport axios from \"axios\";\nimport { JOGAKBO_CONTRACT_ADDRESS } from \"../constants/constants.cypress\";\nvar A2P_API_PREPARE_URL = \"https://a2a-api.klipwallet.com/v2/a2a/prepare\";\nvar APP_NAME = \"JOGAKBO\"; // const isMobile = window.screen.width >= 1280 ? false : true;\n\nvar isMobile = false;\n\nvar getKlipAccessUrl = function getKlipAccessUrl(method, request_key) {\n  if (method === \"QR\") {\n    return \"https://klipwallet.com/?target=/a2a?request_key=\".concat(request_key);\n  }\n\n  return \"kakaotalk://klipwallet/open?url=https://klipwallet.com/?target=/a2a?request_key=\".concat(request_key);\n}; // 캠페인 등록\n\n\nexport var createCampaign = /*#__PURE__*/function () {\n  var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(_campaign_address, // 캠페인 제출자 주소\n  _target_amount, _campaign_ID, setQrvalue, callback) {\n    var functionJson;\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            functionJson = '{\"constant\":false,\"inputs\":[{\"name\":\"_campaign_address\",\"type\":\"address\"},{\"name\":\"_target_amount\",\"type\":\"uint256\"},{\"name\":\"_campaign_ID\",\"type\":\"uint256\"}],\"name\":\"createCampaign\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"}';\n            executeContract(JOGAKBO_CONTRACT_ADDRESS, functionJson, \"0\", \"[\\\"\".concat(_campaign_address, \"\\\",\\\"\").concat(_target_amount, \"\\\",\\\"\").concat(_campaign_ID, \"\\\"]\"), setQrvalue, callback);\n\n          case 2:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n\n  return function createCampaign(_x, _x2, _x3, _x4, _x5) {\n    return _ref.apply(this, arguments);\n  };\n}(); // 환불\n\nexport var refund = /*#__PURE__*/function () {\n  var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(_campaignId, _userAddr, setQrvalue, callback) {\n    var functionJson;\n    return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            functionJson = '{\"constant\":false,\"inputs\":[{\"name\":\"_campaignId\",\"type\":\"uint256\"},{\"name\":\"_userAddr\",\"type\":\"address\"}],\"name\":\"refund\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"}';\n            executeContract(JOGAKBO_CONTRACT_ADDRESS, functionJson, \"0\", \"[\\\"\".concat(_campaignId, \"\\\",\\\"\").concat(_userAddr, \"\\\"]\"), setQrvalue, callback);\n\n          case 2:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2);\n  }));\n\n  return function refund(_x6, _x7, _x8, _x9) {\n    return _ref2.apply(this, arguments);\n  };\n}(); // 기부\n\nexport var donateTocampaign = /*#__PURE__*/function () {\n  var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(_campaignId, _amount, setQrvalue, callback) {\n    var functionJson;\n    return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            functionJson = '{\"constant\":false,\"inputs\":[{\"name\":\"_campaignId\",\"type\":\"uint256\"},{\"name\":\"_amount\",\"type\":\"uint256\"}],\"name\":\"donateTocampaign\",\"outputs\":[],\"payable\":true,\"stateMutability\":\"payable\",\"type\":\"function\"}';\n            executeContract(JOGAKBO_CONTRACT_ADDRESS, functionJson, (_amount * Math.pow(10, 18)).toString(), \"[\\\"\".concat(_campaignId, \"\\\",\\\"\").concat(_amount, \"\\\"]\"), setQrvalue, callback);\n\n          case 2:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, _callee3);\n  }));\n\n  return function donateTocampaign(_x10, _x11, _x12, _x13) {\n    return _ref3.apply(this, arguments);\n  };\n}(); // 환불 상태 변경\n\nexport var setStateToRefund = /*#__PURE__*/function () {\n  var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(_campaignId, setQrvalue, callback) {\n    var functionJson;\n    return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n      while (1) {\n        switch (_context4.prev = _context4.next) {\n          case 0:\n            functionJson = '{\"constant\":false,\"inputs\":[{\"name\":\"_campaignId\",\"type\":\"uint256\"}],\"name\":\"setStateToRefund\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"}';\n            executeContract(JOGAKBO_CONTRACT_ADDRESS, functionJson, \"0\", \"[\\\"\".concat(_campaignId, \"\\\"]\"), setQrvalue, callback);\n\n          case 2:\n          case \"end\":\n            return _context4.stop();\n        }\n      }\n    }, _callee4);\n  }));\n\n  return function setStateToRefund(_x14, _x15, _x16) {\n    return _ref4.apply(this, arguments);\n  };\n}();\nexport var executeContract = function executeContract(txTo, functionJSON, value, params, setQrvalue, callback) {\n  axios.post(A2P_API_PREPARE_URL, {\n    bapp: {\n      name: APP_NAME\n    },\n    type: \"execute_contract\",\n    transaction: {\n      to: txTo,\n      // string\n      value: value,\n      // string\n      abi: functionJSON,\n      // string\n      params: params // string\n\n    }\n  }).then(function (response) {\n    var request_key = response.data.request_key;\n\n    if (isMobile) {\n      window.location.href = getKlipAccessUrl(\"android\", request_key);\n    } else {\n      setQrvalue(getKlipAccessUrl(\"QR\", request_key));\n    }\n\n    var timerId = setInterval(function () {\n      axios.get(\"https://a2a-api.klipwallet.com/v2/a2a/result?request_key=\".concat(request_key)).then(function (res) {\n        if (res.data.result) {\n          console.log(\"[result] \".concat(JSON.stringify(res.data.result)));\n          callback(res.data.result);\n          clearInterval(timerId);\n          setQrvalue(\"DEFAULT\");\n        }\n      });\n    }, 1000);\n  });\n}; // 클립 주소얻기\n\nexport var getAddress = function getAddress(setQrvalue, callback) {\n  axios.post(A2P_API_PREPARE_URL, {\n    bapp: {\n      name: APP_NAME\n    },\n    type: \"auth\"\n  }).then(function (response) {\n    var request_key = response.data.request_key;\n\n    if (isMobile) {\n      window.location.href = getKlipAccessUrl(\"android\", request_key);\n    } else {\n      setQrvalue(getKlipAccessUrl(\"QR\", request_key));\n    }\n\n    console.log(\"response:\".concat(response));\n    var timerId = setInterval(function () {\n      axios.get(\"https://a2a-api.klipwallet.com/v2/a2a/result?request_key=\".concat(request_key)).then(function (res) {\n        if (res.data.result) {\n          console.log(\"[Result] \".concat(JSON.stringify(res.data.result)));\n          callback(res.data.result.klaytn_address);\n          clearInterval(timerId);\n          setQrvalue(\"DEFAULT\");\n        }\n      });\n    }, 1000);\n  });\n};","map":null,"metadata":{},"sourceType":"module"}